"use strict";(self.webpackChunkreal_estate=self.webpackChunkreal_estate||[]).push([[9362],{9362:(e,o,l)=>{l.r(o),l.d(o,{default:()=>j});var i=l(5043),t=l(3216),r=l(5766),n=l.n(r),d=l(4450),s=l(4626),a=l(2554),c=l(3516),u=l(9621),v=l(2145),p=l(6178),m=l.n(p),f=l(9223),y=l.n(f),h=l(216),x=l(579);const j=function(){const e=(0,t.zy)(),{fileData:o,customFields:l}=e.state||{},[r,p]=(0,i.useState)([]),[f,j]=(0,i.useState)([]),[b,g]=(0,i.useState)(!1),S=(0,t.Zp)(),[w,C]=(JSON.parse(localStorage.getItem("user"))._id,(0,i.useState)([])),F={...Object.fromEntries((l||[]).map((e=>[null===e||void 0===e?void 0:e.name,""])))},k=[...null===l||void 0===l?void 0:l.map((e=>{var o;return{Header:null===e||void 0===e?void 0:e.label,accessor:null===e||void 0===e?void 0:e.name,type:null===e||void 0===e?void 0:e.type,formikType:null===e||void 0===e||null===(o=e.validations)||void 0===o?void 0:o.find((e=>e.hasOwnProperty("formikType")))}}))],I=(0,c.Wx)({initialValues:F,onSubmit:(e,o)=>{let{resetForm:l}=o;const i=null===f||void 0===f?void 0:f.map(((o,l)=>{const i={createdDate:new Date,deleted:o[e.deleted||"deleted"]||!1,createBy:JSON.parse(localStorage.getItem("user"))._id};return null===k||void 0===k||k.forEach((l=>{var t,r,n,d;const s=e[null===l||void 0===l?void 0:l.accessor],a=o[s]||"";"date"===(null===l||void 0===l||null===(t=l.type)||void 0===t?void 0:t.toLowerCase())?i[null===l||void 0===l?void 0:l.accessor]=m()(a).isValid()?a:"":"number"===(null===l||void 0===l||null===(r=l.type)||void 0===r?void 0:r.toLowerCase())&&["positive","negative"].includes(null===l||void 0===l||null===(n=l.formikType)||void 0===n?void 0:n.toLowerCase())?i[null===l||void 0===l?void 0:l.accessor]=parseFloat(a)||"":"number"===(null===l||void 0===l||null===(d=l.type)||void 0===d?void 0:d.toLowerCase())?i[null===l||void 0===l?void 0:l.accessor]=parseInt(a,10)||"":i[null===l||void 0===l?void 0:l.accessor]=a})),i}));W(i)}}),{errors:O,touched:E,values:H,handleBlur:G,handleChange:T,handleSubmit:B,setFieldValue:L,resetForm:R}=I,W=async e=>{try{g(!0),200===(await(0,u.d_)("api/opportunityproject/addMany",e)).status&&(v.oR.success("Opportunity Project imported successfully"),R(),S("/opportunityproject"))}catch(o){console.error(o),v.oR.error("Opportunity Project import failed"),R(),S("/opportunityproject")}finally{g(!1)}};return(0,i.useEffect)((()=>{if(o&&o.length>0){(async e=>{const o=new FileReader,l=e.name.split(".").pop().toLowerCase();if(o.onload=async e=>{let{target:o}=e;if("csv"===l){const e=n().parse(o.result,{header:!0}),l=null===e||void 0===e?void 0:e.data;if(l&&l.length>0){j(l);const e=Object.keys(l[0]);p(e)}else v.oR.error("Empty or invalid CSV file"),S("/opportunityproject")}else if("xlsx"===l){const e=new Uint8Array(o.result),l=new(y().Workbook);await l.xlsx.load(e);const i=l.getWorksheet(1),t=[];if(i.eachRow({includeEmpty:!0},((e,o)=>{const l={};e.eachCell({includeEmpty:!0},((e,o)=>{l[i.getCell(1,o).value]=e.value})),t.push(l)})),null===t||void 0===t||t.splice(0,1),j(t),t&&t.length>0){const e=Object.keys(t[0]);p(e)}else v.oR.error("Empty or invalid XLSX file"),S("/opportunityproject")}},"csv"===l)o.readAsText(e);else if("xlsx"===l){const l=new Blob([e]);o.readAsArrayBuffer(l)}})(o[0])}}),[o]),(0,i.useEffect)((()=>{const e=null===r||void 0===r?void 0:r.filter((e=>{const o=null===k||void 0===k?void 0:k.find((o=>e===(null===o||void 0===o?void 0:o.accessor)||e===(null===o||void 0===o?void 0:o.Header)));return!!o&&(L(null===o||void 0===o?void 0:o.accessor,e),!0)}));C(e)}),[r]),(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(h.A,{overflowY:"auto",className:"importTable",children:[(0,x.jsx)(d.Text,{color:"secondaryGray.900",fontSize:"22px",fontWeight:"700",mb:"20px",children:"Import Opportunity Project"}),(0,x.jsx)(d.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,pb:2,gap:1,borderBottom:"1px solid #e2e8f0",children:[{Header:"Fields In Crm",accessor:"crmFields"},{Header:"Fields In File",accessor:"fileFields"}].map(((e,o)=>(0,x.jsx)(d.GridItem,{colSpan:{base:6},fontWeight:"600",fontSize:{sm:"14px",lg:"14px"},color:"secondaryGray.900",style:{textTransform:"uppercase"},children:e.Header},o)))}),(0,x.jsx)(d.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,gap:1,overflowY:"auto",children:null===k||void 0===k?void 0:k.map(((e,o)=>(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(d.GridItem,{colSpan:{base:6},mt:"10px",children:null===e||void 0===e?void 0:e.Header},null===e||void 0===e?void 0:e.id),(0,x.jsx)(d.GridItem,{colSpan:{base:4},children:(0,x.jsxs)(s.l6,{variant:"flushed",fontWeight:"500",isSearchable:!0,value:H[null===e||void 0===e?void 0:e.accessor],name:null===e||void 0===e?void 0:e.accessor,onChange:T,children:[(0,x.jsxs)("option",{value:"",children:[" ",w&&null!==w&&void 0!==w&&w.find((o=>((null===e||void 0===e?void 0:e.Header)===o||(null===e||void 0===e?void 0:e.accessor)===o)&&o))?null===w||void 0===w?void 0:w.find((o=>((null===e||void 0===e?void 0:e.Header)===o||(null===e||void 0===e?void 0:e.accessor)===o)&&o)):"Select Field In File"]}),null===r||void 0===r?void 0:r.map((e=>(0,x.jsx)("option",{value:e,children:e},e)))]})})]})))}),(0,x.jsx)(d.Flex,{Flex:!0,justifyContent:"end",mt:"5",children:(0,x.jsx)(a.Button,{size:"sm",onClick:()=>B(),variant:"brand",children:"Save"})})]})})}}}]);
//# sourceMappingURL=9362.00c0c12d.chunk.js.map