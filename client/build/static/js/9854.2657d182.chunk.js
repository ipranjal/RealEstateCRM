"use strict";(self.webpackChunkreal_estate=self.webpackChunkreal_estate||[]).push([[9854],{9854:(e,l,o)=>{o.r(l),o.d(l,{default:()=>j});var i=o(5043),d=o(3216),n=o(5766),r=o.n(n),t=o(1206),s=o(4450),a=o(4626),v=o(2554),u=o(3516),c=o(9621),p=o(2145),m=o(6178),f=o.n(m),h=o(9223),y=o.n(h),x=o(216),b=o(579);const j=function(){var e,l;const o=(0,d.zy)(),{fileData:n,customFields:m}=(null===o||void 0===o?void 0:o.state)||{},[h,j]=(0,i.useState)([]),[g,S]=((0,t.dU)("gray.200","whiteAlpha.100"),(0,i.useState)([])),[w,C]=(0,i.useState)(!1),F=(0,d.Zp)(),[k,O]=(null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e||e._id,(0,i.useState)([])),I=[{Header:"Fields In Crm",accessor:"crmFields"},{Header:"Fields In File",accessor:"fileFields"}],E={...null===Object||void 0===Object?void 0:Object.fromEntries(null===(l=m||[])||void 0===l?void 0:l.map((e=>[null===e||void 0===e?void 0:e.name,""])))},H=[...null===m||void 0===m?void 0:m.map((e=>{var l;return{Header:null===e||void 0===e?void 0:e.label,accessor:null===e||void 0===e?void 0:e.name,type:null===e||void 0===e?void 0:e.type,formikType:null===e||void 0===e||null===(l=e.validations)||void 0===l?void 0:l.find((e=>e.hasOwnProperty("formikType")))}}))],G=(0,u.Wx)({initialValues:E,onSubmit:(e,l)=>{let{resetForm:o}=l;const i=null===g||void 0===g?void 0:g.map(((l,o)=>{var i;const d={createdDate:new Date,deleted:l[(null===e||void 0===e?void 0:e.deleted)||"deleted"]||!1,createBy:null===(i=JSON.parse(localStorage.getItem("user")))||void 0===i?void 0:i._id};return null===H||void 0===H||H.forEach((o=>{var i,n,r,t,s;const a=e[null===o||void 0===o?void 0:o.accessor],v=l[a]||"";var u;"date"===(null===o||void 0===o||null===(i=o.type)||void 0===i?void 0:i.toLowerCase())?d[null===o||void 0===o?void 0:o.accessor]=null!==(u=f()(v))&&void 0!==u&&u.isValid()?v:"":"number"===(null===o||void 0===o||null===(n=o.type)||void 0===n?void 0:n.toLowerCase())&&null!==(r=["positive","negative"])&&void 0!==r&&r.includes(null===o||void 0===o||null===(t=o.formikType)||void 0===t?void 0:t.toLowerCase())?d[null===o||void 0===o?void 0:o.accessor]=parseFloat(v)||"":"number"===(null===o||void 0===o||null===(s=o.type)||void 0===s?void 0:s.toLowerCase())?d[null===o||void 0===o?void 0:o.accessor]=parseInt(v,10)||"":d[null===o||void 0===o?void 0:o.accessor]=v})),d}));P(i)}}),{errors:T,touched:A,values:B,handleBlur:L,handleChange:R,handleSubmit:W,setFieldValue:_,resetForm:z}=G,P=async e=>{try{C(!0);let l=await(0,c.d_)("api/property/addMany",e);200===(null===l||void 0===l?void 0:l.status)&&(p.oR.success("Properties imported successfully"),z(),F("/properties"))}catch(l){console.error(l),p.oR.error("Properties import failed"),z(),F("/properties")}finally{C(!1)}};return(0,i.useEffect)((()=>{if(n&&(null===n||void 0===n?void 0:n.length)>0){(async e=>{var l,o,i;const d=new FileReader,n=null===e||void 0===e||null===(l=e.name)||void 0===l||null===(o=l.split("."))||void 0===o||null===(i=o.pop())||void 0===i?void 0:i.toLowerCase();if(d.onload=async e=>{let{target:l}=e;if("csv"===n){const e=null===r()||void 0===r()?void 0:r().parse(null===l||void 0===l?void 0:l.result,{header:!0}),o=null===e||void 0===e?void 0:e.data;if(o&&(null===o||void 0===o?void 0:o.length)>0){S(o);const e=null===Object||void 0===Object?void 0:Object.keys(o[0]);j(e)}else p.oR.error("Empty or invalid CSV file"),F("/properties")}else if("xlsx"===n){var o;const e=new Uint8Array(null===l||void 0===l?void 0:l.result),i=new(y().Workbook);await(null===i||void 0===i||null===(o=i.xlsx)||void 0===o?void 0:o.load(e));const d=null===i||void 0===i?void 0:i.getWorksheet(1),n=[];if(null===d||void 0===d||d.eachRow({includeEmpty:!0},((e,l)=>{const o={};null===e||void 0===e||e.eachCell({includeEmpty:!0},((e,l)=>{var i;o[null===d||void 0===d||null===(i=d.getCell(1,l))||void 0===i?void 0:i.value]=null===e||void 0===e?void 0:e.value})),null===n||void 0===n||n.push(o)})),null===n||void 0===n||n.splice(0,1),S(n),n&&(null===n||void 0===n?void 0:n.length)>0){const e=null===Object||void 0===Object?void 0:Object.keys(n[0]);j(e)}else p.oR.error("Empty or invalid XLSX file"),F("/properties")}},"csv"===n)null===d||void 0===d||d.readAsText(e);else if("xlsx"===n){const l=new Blob([e]);null===d||void 0===d||d.readAsArrayBuffer(l)}})(n[0])}}),[n]),(0,i.useEffect)((()=>{const e=null===h||void 0===h?void 0:h.filter((e=>{const l=null===H||void 0===H?void 0:H.find((l=>e===(null===l||void 0===l?void 0:l.accessor)||e===(null===l||void 0===l?void 0:l.Header)));return!!l&&(_(null===l||void 0===l?void 0:l.accessor,e),!0)}));O(e)}),[h]),(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(x.A,{overflowY:"auto",className:"importTable",children:[(0,b.jsxs)(s.Text,{color:"secondaryGray.900",fontSize:"22px",fontWeight:"700",mb:"20px",children:["Import Properties"," "]}),(0,b.jsx)(s.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,pb:2,gap:1,borderBottom:"1px solid #e2e8f0",children:null===I||void 0===I?void 0:I.map(((e,l)=>(0,b.jsx)(s.GridItem,{colSpan:{base:6},fontWeight:"600",fontSize:{sm:"14px",lg:"14px"},color:"secondaryGray.900",style:{textTransform:"uppercase"},children:null===e||void 0===e?void 0:e.Header},l)))}),(0,b.jsx)(s.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,gap:1,overflowY:"auto",children:null===H||void 0===H?void 0:H.map(((e,l)=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s.GridItem,{colSpan:{base:6},mt:"10px",children:null===e||void 0===e?void 0:e.Header},null===e||void 0===e?void 0:e.id),(0,b.jsx)(s.GridItem,{colSpan:{base:4},children:(0,b.jsxs)(a.l6,{variant:"flushed",fontWeight:"500",isSearchable:!0,value:B[null===e||void 0===e?void 0:e.accessor],name:null===e||void 0===e?void 0:e.accessor,onChange:R,children:[(0,b.jsxs)("option",{value:"",children:[" ",k&&null!==k&&void 0!==k&&k.find((l=>((null===e||void 0===e?void 0:e.Header)===l||(null===e||void 0===e?void 0:e.accessor)===l)&&l))?null===k||void 0===k?void 0:k.find((l=>((null===e||void 0===e?void 0:e.Header)===l||(null===e||void 0===e?void 0:e.accessor)===l)&&l)):"Select Field In File"]})," ",null===h||void 0===h?void 0:h.map((e=>(0,b.jsx)("option",{value:e,children:e},e)))]})})]})))}),(0,b.jsx)(s.Flex,{Flex:!0,justifyContent:"end",mt:"5",children:(0,b.jsx)(v.Button,{size:"sm",onClick:()=>W(),variant:"brand",children:"Save"})})]})})}}}]);
//# sourceMappingURL=9854.2657d182.chunk.js.map