"use strict";(self.webpackChunkreal_estate=self.webpackChunkreal_estate||[]).push([[6778],{6778:(e,l,o)=>{o.r(l),o.d(l,{default:()=>b});var i=o(5043),d=o(3216),n=o(5766),t=o.n(n),s=o(4450),a=o(4626),r=o(2554),v=o(3516),u=o(9621),c=o(2145),p=o(6178),m=o.n(p),f=o(9223),h=o.n(f),y=o(216),x=o(579);const b=function(){var e,l;const o=(0,d.zy)(),{fileData:n,customFields:p}=(null===o||void 0===o?void 0:o.state)||{},[f,b]=(0,i.useState)([]),[j,g]=(0,i.useState)([]),[S,w]=(0,i.useState)(!1),C=(0,d.Zp)(),[F,k]=(null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e||e._id,(0,i.useState)([])),O=[{Header:"Fields In Crm",accessor:"crmFields"},{Header:"Fields In File",accessor:"fileFields"}],I={...null===Object||void 0===Object?void 0:Object.fromEntries(null===(l=p||[])||void 0===l?void 0:l.map((e=>[null===e||void 0===e?void 0:e.name,""])))},E=[...null===p||void 0===p?void 0:p.map((e=>{var l;return{Header:null===e||void 0===e?void 0:e.label,accessor:null===e||void 0===e?void 0:e.name,type:null===e||void 0===e?void 0:e.type,formikType:null===e||void 0===e||null===(l=e.validations)||void 0===l?void 0:l.find((e=>e.hasOwnProperty("formikType")))}}))],H=(0,v.Wx)({initialValues:I,onSubmit:(e,l)=>{let{resetForm:o}=l;const i=null===j||void 0===j?void 0:j.map(((l,o)=>{var i,d;const n={createdDate:new Date,deleted:l[(null===e||void 0===e?void 0:e.deleted)||"deleted"]||!1,createBy:null===(i=JSON.parse(localStorage.getItem("user")))||void 0===i?void 0:i._id,modifiedBy:null===(d=JSON.parse(localStorage.getItem("user")))||void 0===d?void 0:d._id};return null===E||void 0===E||E.forEach((o=>{var i,d,t,s,a;const r=e[null===o||void 0===o?void 0:o.accessor],v=l[r]||"";var u;"date"===(null===o||void 0===o||null===(i=o.type)||void 0===i?void 0:i.toLowerCase())?n[null===o||void 0===o?void 0:o.accessor]=null!==(u=m()(v))&&void 0!==u&&u.isValid()?v:"":"number"===(null===o||void 0===o||null===(d=o.type)||void 0===d?void 0:d.toLowerCase())&&null!==(t=["positive","negative"])&&void 0!==t&&t.includes(null===o||void 0===o||null===(s=o.formikType)||void 0===s?void 0:s.toLowerCase())?n[null===o||void 0===o?void 0:o.accessor]=parseFloat(v)||"":"number"===(null===o||void 0===o||null===(a=o.type)||void 0===a?void 0:a.toLowerCase())?n[null===o||void 0===o?void 0:o.accessor]=parseInt(v,10)||"":n[null===o||void 0===o?void 0:o.accessor]=v})),n}));A(i)}}),{errors:B,touched:G,values:T,handleBlur:L,handleChange:R,handleSubmit:W,setFieldValue:_,resetForm:q}=H,A=async e=>{try{w(!0);let l=await(0,u.d_)("api/quotes/addMany",e);200===(null===l||void 0===l?void 0:l.status)&&(c.oR.success("Quotes imported successfully"),q(),C("/quotes"))}catch(l){console.error(l),c.oR.error("Quotes import failed"),q(),C("/quotes")}finally{w(!1)}};return(0,i.useEffect)((()=>{if(n&&(null===n||void 0===n?void 0:n.length)>0){(async e=>{var l,o,i;const d=new FileReader,n=null===e||void 0===e||null===(l=e.name)||void 0===l||null===(o=l.split("."))||void 0===o||null===(i=o.pop())||void 0===i?void 0:i.toLowerCase();if(d.onload=async e=>{let{target:l}=e;if("csv"===n){const e=null===t()||void 0===t()?void 0:t().parse(null===l||void 0===l?void 0:l.result,{header:!0}),o=null===e||void 0===e?void 0:e.data;if(o&&(null===o||void 0===o?void 0:o.length)>0){g(o);const e=null===Object||void 0===Object?void 0:Object.keys(o[0]);b(e)}else c.oR.error("Empty or invalid CSV file"),C("/quotes")}else if("xlsx"===n){const e=new Uint8Array(null===l||void 0===l?void 0:l.result),o=new(h().Workbook);await o.xlsx.load(e);const i=null===o||void 0===o?void 0:o.getWorksheet(1),d=[];if(i.eachRow({includeEmpty:!0},((e,l)=>{const o={};e.eachCell({includeEmpty:!0},((e,l)=>{var d;o[null===i||void 0===i||null===(d=i.getCell(1,l))||void 0===d?void 0:d.value]=null===e||void 0===e?void 0:e.value})),null===d||void 0===d||d.push(o)})),null===d||void 0===d||d.splice(0,1),g(d),d&&(null===d||void 0===d?void 0:d.length)>0){const e=null===Object||void 0===Object?void 0:Object.keys(d[0]);b(e)}else c.oR.error("Empty or invalid XLSX file"),C("/quotes")}},"csv"===n)null===d||void 0===d||d.readAsText(e);else if("xlsx"===n){const l=new Blob([e]);null===d||void 0===d||d.readAsArrayBuffer(l)}})(n[0])}}),[n]),(0,i.useEffect)((()=>{const e=null===f||void 0===f?void 0:f.filter((e=>{const l=null===E||void 0===E?void 0:E.find((l=>e===(null===l||void 0===l?void 0:l.accessor)||e===(null===l||void 0===l?void 0:l.Header)));return!!l&&(_(null===l||void 0===l?void 0:l.accessor,e),!0)}));k(e)}),[f]),(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(y.A,{overflowY:"auto",className:"importTable",children:[(0,x.jsx)(s.Text,{color:"secondaryGray.900",fontSize:"22px",fontWeight:"700",mb:"20px",children:"Import Quotes"}),(0,x.jsx)(s.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,pb:2,gap:1,borderBottom:"1px solid #e2e8f0",children:null===O||void 0===O?void 0:O.map(((e,l)=>(0,x.jsx)(s.GridItem,{colSpan:{base:6},fontWeight:"600",fontSize:{sm:"14px",lg:"14px"},color:"secondaryGray.900",style:{textTransform:"uppercase"},children:null===e||void 0===e?void 0:e.Header},l)))}),(0,x.jsx)(s.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,gap:1,overflowY:"auto",children:null===E||void 0===E?void 0:E.map(((e,l)=>(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(s.GridItem,{colSpan:{base:6},mt:"10px",children:null===e||void 0===e?void 0:e.Header},null===e||void 0===e?void 0:e.id),(0,x.jsx)(s.GridItem,{colSpan:{base:4},children:(0,x.jsxs)(a.l6,{variant:"flushed",fontWeight:"500",isSearchable:!0,value:T[null===e||void 0===e?void 0:e.accessor],name:null===e||void 0===e?void 0:e.accessor,onChange:R,children:[(0,x.jsxs)("option",{value:"",children:[" ",F&&null!==F&&void 0!==F&&F.find((l=>((null===e||void 0===e?void 0:e.Header)===l||(null===e||void 0===e?void 0:e.accessor)===l)&&l))?null===F||void 0===F?void 0:F.find((l=>((null===e||void 0===e?void 0:e.Header)===l||(null===e||void 0===e?void 0:e.accessor)===l)&&l)):"Select Field In File"]}),null===f||void 0===f?void 0:f.map((e=>(0,x.jsx)("option",{value:e,children:e},e)))]})})]})))}),(0,x.jsx)(s.Flex,{Flex:!0,justifyContent:"end",mt:"5",children:(0,x.jsx)(r.Button,{size:"sm",onClick:()=>W(),variant:"brand",children:"Save"})})]})})}}}]);
//# sourceMappingURL=6778.f57d98ef.chunk.js.map