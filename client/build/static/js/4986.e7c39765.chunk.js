"use strict";(self.webpackChunkreal_estate=self.webpackChunkreal_estate||[]).push([[4986],{4986:(e,l,o)=>{o.r(l),o.d(l,{default:()=>b});var i=o(5043),d=o(3216),n=o(5766),t=o.n(n),a=o(4450),s=o(4626),r=o(2554),v=o(3516),c=o(9621),u=o(2145),p=o(6178),m=o.n(p),f=o(9223),h=o.n(f),x=o(216),y=o(579);const b=function(){var e;const l=(0,d.zy)(),{fileData:o,customFields:n}=(null===l||void 0===l?void 0:l.state)||{},[p,f]=(0,i.useState)([]),[b,j]=(0,i.useState)([]),[g,C]=(0,i.useState)(!1),S=(0,d.Zp)(),[w,F]=(null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e||e._id,(0,i.useState)([])),k=[{Header:"Fields In Crm",accessor:"crmFields"},{Header:"Fields In File",accessor:"fileFields"}],I={...null===Object||void 0===Object?void 0:Object.fromEntries((n||[]).map((e=>[null===e||void 0===e?void 0:e.name,""])))},O=[...null===n||void 0===n?void 0:n.map((e=>{var l;return{Header:null===e||void 0===e?void 0:e.label,accessor:null===e||void 0===e?void 0:e.name,type:null===e||void 0===e?void 0:e.type,formikType:null===e||void 0===e||null===(l=e.validations)||void 0===l?void 0:l.find((e=>null===e||void 0===e?void 0:e.hasOwnProperty("formikType")))}}))],E=(0,v.Wx)({initialValues:I,onSubmit:(e,l)=>{let{resetForm:o}=l;const i=null===b||void 0===b?void 0:b.map(((l,o)=>{var i;const d={createdDate:new Date,deleted:l[e.deleted||"deleted"]||!1,createBy:null===(i=JSON.parse(localStorage.getItem("user")))||void 0===i?void 0:i._id};return null===O||void 0===O||O.forEach((o=>{var i,n,t,a;const s=e[null===o||void 0===o?void 0:o.accessor],r=l[s]||"";"date"===(null===o||void 0===o||null===(i=o.type)||void 0===i?void 0:i.toLowerCase())?d[null===o||void 0===o?void 0:o.accessor]=m()(r).isValid()?r:"":"number"===(null===o||void 0===o||null===(n=o.type)||void 0===n?void 0:n.toLowerCase())&&["positive","negative"].includes(null===o||void 0===o||null===(t=o.formikType)||void 0===t?void 0:t.toLowerCase())?d[null===o||void 0===o?void 0:o.accessor]=parseFloat(r)||"":"number"===(null===o||void 0===o||null===(a=o.type)||void 0===a?void 0:a.toLowerCase())?d[null===o||void 0===o?void 0:o.accessor]=parseInt(r,10)||"":d[null===o||void 0===o?void 0:o.accessor]=r})),d}));_(i)}}),{errors:H,touched:G,values:T,handleBlur:B,handleChange:L,handleSubmit:R,setFieldValue:W,resetForm:A}=E,_=async e=>{try{C(!0);let l=await(0,c.d_)("api/contact/addMany",e);200===(null===l||void 0===l?void 0:l.status)&&(u.oR.success("Contacts imported successfully"),A(),S("/contacts"))}catch(l){console.error(l),u.oR.error("Contacts import failed"),A(),S("/contacts")}finally{C(!1)}};return(0,i.useEffect)((()=>{if(o&&(null===o||void 0===o?void 0:o.length)>0){(async e=>{var l,o,i;const d=new FileReader,n=null===e||void 0===e||null===(l=e.name)||void 0===l||null===(o=l.split("."))||void 0===o||null===(i=o.pop())||void 0===i?void 0:i.toLowerCase();if(d.onload=async e=>{let{target:l}=e;if("csv"===n){const e=null===t()||void 0===t()?void 0:t().parse(null===l||void 0===l?void 0:l.result,{header:!0}),o=null===e||void 0===e?void 0:e.data;if(o&&(null===o||void 0===o?void 0:o.length)>0){j(o);const e=Object.keys(o[0]);f(e)}else u.oR.error("Empty or invalid CSV file"),S("/contacts")}else if("xlsx"===n){const e=new Uint8Array(l.result),o=new(h().Workbook);await o.xlsx.load(e);const i=o.getWorksheet(1),d=[];if(null===i||void 0===i||i.eachRow({includeEmpty:!0},((e,l)=>{const o={};null===e||void 0===e||e.eachCell({includeEmpty:!0},((e,l)=>{var d;o[null===i||void 0===i||null===(d=i.getCell(1,l))||void 0===d?void 0:d.value]=null===e||void 0===e?void 0:e.value})),null===d||void 0===d||d.push(o)})),null===d||void 0===d||d.splice(0,1),j(d),d&&(null===d||void 0===d?void 0:d.length)>0){const e=null===Object||void 0===Object?void 0:Object.keys(d[0]);f(e)}else u.oR.error("Empty or invalid XLSX file"),S("/contacts")}},"csv"===n)null===d||void 0===d||d.readAsText(e);else if("xlsx"===n){const l=new Blob([e]);null===d||void 0===d||d.readAsArrayBuffer(l)}})(o[0])}}),[o]),(0,i.useEffect)((()=>{const e=null===p||void 0===p?void 0:p.filter((e=>{const l=null===O||void 0===O?void 0:O.find((l=>e===(null===l||void 0===l?void 0:l.accessor)||e===(null===l||void 0===l?void 0:l.Header)));return!!l&&(W(null===l||void 0===l?void 0:l.accessor,e),!0)}));F(e)}),[p]),(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(x.A,{overflowY:"auto",className:"importTable",children:[(0,y.jsx)(a.Text,{color:"secondaryGray.900",fontSize:"22px",fontWeight:"700",mb:"20px",children:"Import Contacts"}),(0,y.jsx)(a.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,pb:2,gap:1,borderBottom:"1px solid #e2e8f0",children:null===k||void 0===k?void 0:k.map(((e,l)=>(0,y.jsx)(a.GridItem,{colSpan:{base:6},fontWeight:"600",fontSize:{sm:"14px",lg:"14px"},color:"secondaryGray.900",style:{textTransform:"uppercase"},children:null===e||void 0===e?void 0:e.Header},l)))}),(0,y.jsx)(a.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,gap:1,overflowY:"auto",children:null===O||void 0===O?void 0:O.map(((e,l)=>(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(a.GridItem,{colSpan:{base:6},mt:"10px",children:null===e||void 0===e?void 0:e.Header},null===e||void 0===e?void 0:e.id),(0,y.jsx)(a.GridItem,{colSpan:{base:4},children:(0,y.jsxs)(s.l6,{variant:"flushed",fontWeight:"500",isSearchable:!0,value:T[null===e||void 0===e?void 0:e.accessor],name:null===e||void 0===e?void 0:e.accessor,onChange:L,children:[(0,y.jsxs)("option",{value:"",children:[" ",w&&null!==w&&void 0!==w&&w.find((l=>((null===e||void 0===e?void 0:e.Header)===l||(null===e||void 0===e?void 0:e.accessor)===l)&&l))?null===w||void 0===w?void 0:w.find((l=>((null===e||void 0===e?void 0:e.Header)===l||(null===e||void 0===e?void 0:e.accessor)===l)&&l)):"Select Field In File"]}),null===p||void 0===p?void 0:p.map((e=>(0,y.jsx)("option",{value:e,children:e},e)))]})})]})))}),(0,y.jsx)(a.Flex,{Flex:!0,justifyContent:"end",mt:"5",children:(0,y.jsx)(r.Button,{size:"sm",onClick:()=>R(),variant:"brand",children:"Save"})})]})})}}}]);
//# sourceMappingURL=4986.e7c39765.chunk.js.map